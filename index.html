<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Генератор VM-шаблонов</title>
  <style>
    body { 
      font-family: 'Inter', sans-serif; margin: 0; padding: 10px; background: #FFFFFF;
      display: flex;
   }
    .elems{
      width: 25%;
      margin-top: 48px;
      padding: 40px 8px 8px 28px;
      border-bottom: 1px solid #2563EB;
      border-left: 1px solid #2563EB;
      border-top: 1px solid #2563EB;
      border-bottom-left-radius: 12px;
      border-top-left-radius: 12px;
    }
    .container {
      border: 1px solid #2563EB;
      width: 80%;
      margin-top: 48px;
      padding: 0px 48px 48px 48px;
      border-bottom-right-radius: 12px;
      border-top-right-radius: 12px;
    }
    h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #1E293B;
      text-align: center;
      margin-bottom: 32px; /* Increased spacing */
    }

    .input-group {
      margin-bottom: 24px; /* Increased spacing */
    }

    label {
      display: block;
      font-size: 1rem;
      font-weight: 500;
      color: #334155;
      margin-bottom: 8px;
    }

    input[type="text"],
    .custom-file-upload {
    border: 1px solid #2563EB;
    height: 40px;
    width: 280px;
      padding: 12px;
      border-radius: 6px;
      font-size: 1rem;
      color: #4B5563;
      outline: none;
    }
    input[type="file"] {
  display: none;
}

.custom-file-upload {
  cursor: pointer;
}
article{
  display: flex;
  align-items: center;
}
img{
  margin-right: 20px;
  width:50px;
  height:50px;
}

    input[type="text"]:focus,
    input[type="file"]:focus {
      border-color: #ebd425;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
    }

    input[type="file"] {
      margin-top: 4px;
    }

    button {
      padding: 14px 24px;
      margin-left: 80%;
      background: #2563EB;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      transition: background-color 0.2s ease;
    }

    button:disabled {
      background: #9CA3AF;
      cursor: not-allowed;
    }

    button:hover:not(:disabled) {
      background: #1E40AF;
    }

    pre {
      background: #F3F4F6;
      padding: 24px;
      border-radius: 6px;
      display: none;
      overflow-x: auto;
      white-space: pre;
      font-size: 0.875rem;
      color: #374151;
      line-height: 1.5;
    }

    /* Стиль для обязательных полей */
    .required-field:after {
      content: "*";
      color: red;
      margin-left: 4px;
    }

    /* Дополнительные стили для улучшения внешнего вида */
    .input-group:last-child {
      margin-bottom: 0;
    }


      /* Добавляем отступы между инпутами */
    .input-group > label {
      margin-bottom: 8px; /* Adds spacing between labels and inputs */
    }


  </style>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="elems">
        <article>
            <img src="Rocket_Unselected.png" alt="">
                        <p>Создать Услугу</p>
        </article>
        <article>
            <img src="Folder_Unselected.png" alt="">
                        <p>Мои проекты</p>
        </article>
        <article>
            <img src="View_Unselected.png" alt="">
                        <p>Инструкции</p>
        </article>
    </div>
  <div class="container">
    <h1>Прикрепите файлы</h1>
    <ul>
    <li class="input-group">
      <label for="projectNameInput" class="required-field">Название проекта:</label>
      <input type="text" id="projectNameInput" placeholder="Введите название" />
    </li>

    <li class="input-group">
        <label for="jsonSchemaInput" class="required-field">JSON-схема услуги</label>
      <label for="jsonSchemaInput" class="custom-file-upload">загрузить файл</label>
      <input type="file" id="jsonSchemaInput" accept=".json" />
    </li>

    <li class="input-group">
      <label for="xsdSchemaInput" class="required-field">XSD-схема вида сведений</label>
      <label for="xsdSchemaInput" class="custom-file-upload">загрузить файл</label>
      <input type="file" id="xsdSchemaInput" accept=".xsd" />
    </ul>
    <li class="input-group">
      <label for="testJsonsInput" class="required-field">Тестовые JSON-файлы (необязательно):</label>
      <label for="testJsonsInput" class="custom-file-upload">загрузить файл</label>
      <input type="file" id="testJsonsInput" accept=".json" multiple />
    </li>
    </ul>
    <button id="generateBtn" disabled>Создать</button>
      <pre id="vmCodeDisplay"></pre>
  <script>
    const projectNameInput = document.getElementById('projectNameInput');
    const jsonSchemaInput = document.getElementById('jsonSchemaInput');
    const xsdSchemaInput = document.getElementById('xsdSchemaInput');
    const testJsonsInput = document.getElementById('testJsonsInput');
    const generateBtn = document.getElementById('generateBtn');
    const vmCodeDisplay = document.getElementById('vmCodeDisplay');

    let projectName = '';
    let jsonSchema = null;
    let xsdSchema = null;
    let testJsons = [];

    function updateCanGenerate() {
      generateBtn.disabled = !(projectName && jsonSchema && xsdSchema);
    }

    projectNameInput.addEventListener('input', () => {
      projectName = projectNameInput.value.trim();
      updateCanGenerate();
    });

    jsonSchemaInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        const text = await file.text();
        try {
          jsonSchema = JSON.parse(text);
          jsonSchemaInput.style.borderColor = 'green';
        } catch (err) {
          alert('Ошибка парсинга JSON-схемы');
          jsonSchemaInput.style.borderColor = 'red';
          jsonSchema = null;
        }
      } else {
        jsonSchema = null;
      }
      updateCanGenerate();
    });

    xsdSchemaInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file) {
        xsdSchema = await file.text();
        xsdSchemaInput.style.borderColor = 'green';
      } else {
        xsdSchema = null;
      }
      updateCanGenerate();
    });

    testJsonsInput.addEventListener('change', async (e) => {
      testJsons = [];
      for (const file of e.target.files) {
        const text = await file.text();
        try {
          testJsons.push(JSON.parse(text));
        } catch (err) {
          console.warn(`Ошибка парсинга ${file.name}`);
        }
      }
    });

    // Фиксированные параметры (по умолчанию)
    const params = {
      prefix: "soc:",
      handleNullValues: "omit",
      dateFormat: "yyyy-MM-dd",
      transformFieldNames: "pascalCase",
      generateConditionals: true,
      listElementName: "Child",
      parseJsonStrings: true
    };

    generateBtn.addEventListener('click', async () => {
      if (!window.electronAPI) {
        alert("API не загружено");
        return;
      }

      const data = {
        projectName,
        jsonSchema,
        xsdSchema,
        testJsons
      };

      try {
        const vmCode = await window.electronAPI.createVMTemplate(null, data, params);
        vmCodeDisplay.textContent = vmCode;
        vmCodeDisplay.style.display="block";
      } catch (err) {
        alert("Ошибка генерации: " + err.message);
      }
    });

    updateCanGenerate();
  </script>
</body>
</html>
